<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Trading Dashboard</title>
    <meta http-equiv="refresh" content="120"> <!-- alle 2 Min -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 2rem;
            background-color: #f9f9f9;
        }
        .gain {
            color: green;
            font-weight: bold;
        }
        .loss {
            color: red;
            font-weight: bold;
        }
        .card-header {
            font-weight: bold;
        }
        .api-fail {
            color: #dc3545;
        }
        .api-ok {
            color: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">ðŸ“Š Trading Dashboard</h1>
        <p><a href="/logout" class="btn btn-outline-danger">Abmelden</a></p>

        <!-- GESAMTÃœBERSICHT -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-header">Aktueller Gesamtwert</div>
                    <div class="card-body">
                        <h4>${{ total_balance }}</h4>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-header">Gesamt PnL</div>
                    <div class="card-body">
                        <p class="{{ 'gain' if total_pnl >= 0 else 'loss' }}">
                            {{ total_pnl_str }} ({{ total_pnl_percent }}%)
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card text-center">
                    <div class="card-header">1-Tages</div>
                    <div class="card-body">
                        <p class="{{ 'gain' if pnl_1d >= 0 else 'loss' }}">
                            {{ pnl_1d_str }} ({{ pnl_1d_percent }}%)
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card text-center">
                    <div class="card-header">7-Tage</div>
                    <div class="card-body">
                        <p class="{{ 'gain' if pnl_7d >= 0 else 'loss' }}">
                            {{ pnl_7d_str }} ({{ pnl_7d_percent }}%)
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card text-center">
                    <div class="card-header">30-Tage</div>
                    <div class="card-body">
                        <p class="{{ 'gain' if pnl_30d >= 0 else 'loss' }}">
                            {{ pnl_30d_str }} ({{ pnl_30d_percent }}%)
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SUBACCOUNT DETAILS -->
        {% for acc in subaccounts %}
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between">
                <span>{{ acc.name }}</span>
                <span class="{{ 'api-ok' if acc.api_ok else 'api-fail' }}">
                    {{ "ðŸŸ¢ API OK" if acc.api_ok else "ðŸ”´ API FEHLER" }}
                </span>
            </div>
            <div class="card-body">
                <p><strong>Guthaben:</strong> ${{ acc.balance }}</p>
                <p><strong>Performance:</strong>
                    <span class="{{ 'gain' if acc.pnl >= 0 else 'loss' }}">
                        {{ acc.pnl_str }} ({{ acc.pnl_percent }}%)
                    </span>
                </p>

                {% if acc.positions %}
                <h6>Offene Positionen:</h6>
                <ul>
                    {% for pos in acc.positions %}
                    <li>
                        {{ pos.symbol }} â€“ GrÃ¶ÃŸe: {{ pos.size }},
                        <strong style="color: {{ 'green' if pos.pnl >= 0 else 'red' }}">
                            PnL: {{ pos.pnl }}
                        </strong>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                    <p>Keine offenen Positionen oder Daten nicht verfÃ¼gbar.</p>
                {% endif %}

                {% if acc.coins %}
                <h6>Coin-Performance:</h6>
                <ul>
                    {% for coin in acc.coins %}
                    <li>
                        {{ coin.symbol }} â€“ {{ coin.amount }}
                        <span class="{{ 'gain' if coin.pnl >= 0 else 'loss' }}">
                            ({{ coin.pnl_str }} / {{ coin.pnl_percent }}%)
                        </span>
                    </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
        </div>
        {% endfor %}

        <!-- CHART -->
        <div class="card mt-5">
            <div class="card-header">Strategie Performance</div>
            <div class="card-body text-center">
                <img src="/static/chart.png" alt="Strategie Chart" class="img-fluid">
            </div>
        </div>
    </div>
</body>
</html>
