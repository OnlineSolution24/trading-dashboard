
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>ðŸ“Š Trading Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <meta http-equiv="refresh" content="300">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 30px;
        }
        .account-box {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
        }
        .api-ok { color: green; }
        .api-fail { color: red; }
        .gain { color: green; }
        .loss { color: red; }
        .chart-img {
            width: 100%;
            max-width: 1000px;
            margin: 30px auto;
            display: block;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="mb-4">ðŸ“ˆ Trading Dashboard</h1>
    <a href="/logout" class="btn btn-danger mb-4">Abmelden</a>

    <div class="row text-center mb-4">
        <div class="col-md-3">
            <div class="p-3 bg-light border rounded">
                <h5>ðŸ’° Startkapital</h5>
                <p><strong>$13.729,37</strong></p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="p-3 bg-light border rounded">
                <h5>ðŸ“¦ Aktuelles Guthaben</h5>
                <p><strong>{{ total_balance }} $</strong></p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="p-3 bg-light border rounded">
                <h5>ðŸ“‰ Gesamt PnL</h5>
                <p class="{{ 'gain' if total_pnl >= 0 else 'loss' }}">
                    <strong>{{ total_pnl | round(2) }} $ ({{ total_pnl_percent | round(2) }}%)</strong>
                </p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="p-3 bg-light border rounded">
                <h5>ðŸ“… 1-Tages-Performance</h5>
                <p><strong>{{ perf_1d }}</strong></p>
            </div>
        </div>
        <div class="col-md-3 mt-2">
            <div class="p-3 bg-light border rounded">
                <h5>ðŸ“… 7-Tage-Performance</h5>
                <p><strong>{{ perf_7d }}</strong></p>
            </div>
        </div>
        <div class="col-md-3 mt-2">
            <div class="p-3 bg-light border rounded">
                <h5>ðŸ“… 30-Tage-Performance</h5>
                <p><strong>{{ perf_30d }}</strong></p>
            </div>
        </div>
    </div>

    <h3 class="mt-5">ðŸ“Š Verteilung Ãœbersicht</h3>
    <img src="{{ url_for('static', filename='account_pnl_chart.png') }}" class="chart-img" alt="Performance Chart">

    {% for acc in account_data %}
        <div class="account-box">
            <h4>
                {{ acc.name }}
                <span class="{{ 'api-ok' if acc.api_status else 'api-fail' }}">
                    [{{ 'API OK' if acc.api_status else 'API FEHLER' }}]
                </span>
            </h4>
            <p>ðŸ’µ Guthaben: <strong>{{ acc.balance }} $</strong>
                {% if acc.pnl is defined %}
                    (<span class="{{ 'gain' if acc.pnl >= 0 else 'loss' }}">{{ acc.pnl }} $ | {{ acc.pnl_percent }}%</span>)
                {% endif %}
            </p>

            {% if acc.positions %}
                <h5>Offene Positionen:</h5>
                <ul>
                    {% for pos in acc.positions %}
                        <li style="color: {% if pos.pnl >= 0 %}green{% else %}red{% endif %};">
                            {{ pos.symbol }} â€“ GrÃ¶ÃŸe: {{ pos.size }} | PnL: {{ pos.pnl }}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if acc.coins %}
                <h5>ðŸª™ Coin-Details:</h5>
                <ul>
                    {% for coin in acc.coins %}
                        <li>
                            {{ coin.name }}: {{ coin.amount }} â†’ 
                            <span class="{{ 'gain' if coin.pnl >= 0 else 'loss' }}">
                                {{ coin.pnl }} $ ({{ coin.pnl_percent }}%)
                            </span>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endfor %}
</div>

</body>
</html>
