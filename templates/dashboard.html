<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>📊 Trading Dashboard</title>
  <meta http-equiv="refresh" content="300"> <!-- Auto-Refresh alle 5 Minuten -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; padding: 20px; font-family: Arial, sans-serif; }
    .gain { color: green; }
    .loss { color: red; }
    .box { border: 1px solid #ccc; border-radius: 10px; padding: 15px; margin: 10px 0; background: white; }
    .account-name { font-weight: bold; font-size: 1.1em; }
    .position-item { margin-bottom: 5px; }
    .api-error { color: #ff0000; font-weight: bold; }
    .summary-table td { padding: 4px 10px; }
    img.chart-img { max-width: 100%; height: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">📊 Trading Dashboard</h1>

    <div class="row mb-4">
      <div class="col-md-4 box">
        <h5>📌 Startkapital</h5>
        <p><strong>$13.729,37</strong></p>
      </div>
      <div class="col-md-4 box">
        <h5>📈 Aktueller Wert</h5>
        <p><strong>${{ total_balance }}</strong></p>
      </div>
      <div class="col-md-4 box">
        <h5>💹 Gesamt PNL</h5>
        <p class="{{ 'gain' if total_pnl >= 0 else 'loss' }}">
          {{ total_pnl_percent }}% ({{ total_pnl_str }})
        </p>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-4 box">
        <h5>🕐 1-Tages Performance</h5>
        <p class="{{ 'gain' if pnl_1d >= 0 else 'loss' }}">
          {{ pnl_1d_percent }}% ({{ pnl_1d_str }})
        </p>
      </div>
      <div class="col-md-4 box">
        <h5>📅 7-Tage Performance</h5>
        <p class="{{ 'gain' if pnl_7d >= 0 else 'loss' }}">
          {{ pnl_7d_percent }}% ({{ pnl_7d_str }})
        </p>
      </div>
      <div class="col-md-4 box">
        <h5>📆 30-Tage Performance</h5>
        <p class="{{ 'gain' if pnl_30d >= 0 else 'loss' }}">
          {{ pnl_30d_percent }}% ({{ pnl_30d_str }})
        </p>
      </div>
    </div>

    <div class="mb-5">
      <h4>📉 Performance Übersicht</h4>
      <img src="{{ url_for('static', filename='pnl_chart.png') }}" alt="PNL Chart" class="chart-img" />
    </div>

    {% for acc in subaccounts %}
    <div class="box">
      <div class="account-name">{{ acc.name }}
        {% if acc.api_error %}
          <span class="api-error">❌ API FEHLER</span>
        {% else %}
          <span class="text-muted">✅</span>
        {% endif %}
      </div>

      <p><strong>Guthaben:</strong> ${{ acc.balance }} |
        <span class="{{ 'gain' if acc.pnl >= 0 else 'loss' }}">
          {{ acc.pnl_percent }}% ({{ acc.pnl_str }})
        </span>
      </p>

      <h6>Offene Positionen</h6>
      <ul>
        {% for p in acc.positions %}
          <li class="position-item {{ 'gain' if p.pnl >= 0 else 'loss' }}">
            {{ p.symbol }} | Größe: {{ p.size }} | PnL: {{ p.pnl }}
          </li>
        {% else %}
          <li class="text-muted">Keine offenen Positionen</li>
        {% endfor %}
      </ul>

      {% if acc.coin_stats %}
        <h6>📊 Coin Performance</h6>
        <table class="table table-sm table-bordered summary-table">
          <thead>
            <tr>
              <th>Coin</th>
              <th>Verfügbar</th>
              <th>PNL</th>
            </tr>
          </thead>
          <tbody>
            {% for coin in acc.coin_stats %}
            <tr>
              <td>{{ coin.name }}</td>
              <td>${{ coin.available }}</td>
              <td class="{{ 'gain' if coin.pnl >= 0 else 'loss' }}">
                {{ coin.pnl_percent }}% ({{ coin.pnl_str }})
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</body>
</html>
